webpackJsonp([1],{0:function(e,t,n){e.exports=n("D9uV")},"74/Y":function(e,t){e.exports='<div class="design-page-wrapper">\r\n  <div class="design-container">\r\n    <div v-show="masterId <= 0" class="design-no-master-container">\r\n      <span id="noMaster-0placeholder-plus" class="icon-module-add" @click="addModuleHandle(\'noMaster\',\'0placeholder\')">\r\n        <i class="glyphicon glyphicon-plus"></i>\r\n      </span>\r\n      <div class="module-design-wrapper" v-for="item in masterPlaceMap[\'noMaster\'][\'0placeholder\']">\r\n        <div class="module-arrow-wrapper">\r\n          <span class="icon-module-edit" @click="editModuleHandle(\'noMaster\',\'0placeholder\',item.moduleId,item.sort)">\r\n            <i class="glyphicon glyphicon-edit"></i>\r\n          </span>\r\n          <span class="icon-module-sort-up" @click="sortModuleHandle(\'noMaster\',\'0placeholder\',item.moduleId,item.sort,\'up\')">\r\n            <i class="glyphicon glyphicon-arrow-up"></i>\r\n          </span>\r\n          <span class="icon-module-sort-down" @click="sortModuleHandle(\'noMaster\',\'0placeholder\',item.moduleId,item.sort,\'down\')">\r\n            <i class="glyphicon glyphicon-arrow-down"></i>\r\n          </span>\r\n          <span class="icon-module-sort-remove" @click="removeModuleHandle(\'noMaster\',\'0placeholder\',item.moduleId,item.sort)">\r\n            <i class="glyphicon glyphicon glyphicon-remove"></i>\r\n          </span>\r\n        </div>\r\n        <div class="module-content" v-html="item.content"></div>\r\n      </div>\r\n    </div>\r\n    <div id="placeRef">\r\n\r\n    </div>\r\n  </div>\r\n  \x3c!-- <module :paginationConf="paginationConf" :moduleList="moduleList" @choosePaginationEvent="choosePaginationHandle" @chooseModuleEvent="chooseModuleHandle">\r\n  </module>\r\n\r\n  <div :class="\'json-schema-form-container row\' + schemaDialogClass">\r\n    <span @click="closeSchemaDialog"  class="glyphicon glyphicon-chevron-right schema-dialog-close"></span>\r\n    <div id="json-schema-form" class="col-ms-8 json-schema-form">\r\n\r\n    </div>\r\n  </div> --\x3e\r\n</div>'},D9uV:function(e,t,n){function o(e){return e&&e.__esModule?e:{default:e}}n("4ty1");var r=n("sxZj"),a=o(r),s=n("xmyw"),i=o(s);new a.default({el:"#app",render:function(e){return e(i.default)}})},KFBP:function(e,t){},xmyw:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("KFBP"),r=(n.n(o),n("0I0U")),a=n("LVMs"),s=(n.n(a),n("hdNw")),i=n("9agz"),l=n("E7Ie"),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function i(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,i)}l((o=o.apply(e,t||[])).next())})},u=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,a&&(s=2&n[0]?a.return:n[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],a=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,a,s,i,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},h=(n("YwWX"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pageServiceInstance=a.Container.get("pageService"),t.masterServiceInstance=a.Container.get("masterService"),t.designServiceInstance=a.Container.get("designService"),t.paginationConf={totalRecord:0,pageSize:10},t.moduleList=new i.a.ModuleListModel,t.masterModel=new l.a.MasterModel,t.masterPlaceMap={noMaster:{"0placeholder":[]},haveMaster:{}},t.pageId=0,t.masterId=0,t.placeholder="",t.masterKey="",t.isShowSchemaDialog=!1,t.schemaDialogClass="",t.placeholderModuleSort=0,t}return c(t,e),t.prototype.mounted=function(){window.designFrameVM=this},t.prototype.savePageModuleRelation=function(){return p(this,void 0,void 0,function(){var e,t,n,o,r,s,l;return u(this,function(c){switch(c.label){case 0:e=null,e=this.masterId>0?this.masterPlaceMap.haveMaster:this.masterPlaceMap.noMaster,t=new Array;for(n in e)for(o=0;o<e[n].length;o++)r=e[n][o],s=new i.a.PageModuleModel,s.masterId=this.masterId,s.data=r.data,s.placeholder=n,s.sort=o+1,s.versionInfoId=r.versionInfoId,t.push(s);return[4,a.Container.get("designService").saveDesignPageModules(this.pageId,t)];case 1:return l=c.sent(),l?[2,!1]:[2,!0]}})})},t.prototype.publishPage=function(){},t.prototype.designPageModuleInit=function(e,t){return p(this,void 0,void 0,function(){var n,o,s,i,l,c,d,p,h,m,v,f,g,M,y,I,M;return u(this,function(u){switch(u.label){case 0:return this.parentVm=t,this.pageId=e,n=this,[4,this.pageServiceInstance.getPageDetailById(e)];case 1:if(!(o=u.sent())||o.errorCode)throw Error("design page happen error!");return s=o,s.masterId>0?(this.masterId=s.masterId,[4,this.masterServiceInstance.getMasterDetailById(s.masterId)]):[3,4];case 2:if(i=u.sent(),this.masterModel=i,l=this.masterModel.content,c=/<\s*body[^>]*\s*>([\s\S]*)<\s*\/body\s*>/gm,c.test(l)){for(l=RegExp.$1,l=l.replace(/[\r\n]/gm,""),l=l.trim(),d=/(<\s*div[^>]*\s*place\s*=\s*"\s*([^""]+)\s*"\s*>)+/gi,p=l.match(d),h=0;h<p.length;h++)m=/<\s*div[^>]*\s*place\s*=\s*"\s*([^""]+)\s*"\s*>/gi,m.test(p[h]),this.$set(n.masterPlaceMap.haveMaster,""+RegExp.$1,[]),l=l.replace(""+p[h],p[h]+'\n              <span id="haveMaster-'+RegExp.$1+'-plus" class="icon-module-add" @click="addModuleHandle(\'haveMaster\',\''+RegExp.$1+'\')">\n                <i class="glyphicon glyphicon-plus"></i>\n              </span>\n              <div class="module-design-wrapper" \n                v-for="item in masterPlaceMap[\'haveMaster\'][\''+RegExp.$1+'\']">\n                <div class="module-arrow-wrapper">\n                  <span class="icon-module-edit" @click="editModuleHandle(\'haveMaster\',\''+RegExp.$1+'\',item.moduleId,item.sort)">\n                    <i class="glyphicon glyphicon-edit"></i>\n                  </span>\n                  <span class="icon-module-sort-up" @click="sortModuleHandle(\'haveMaster\',\''+RegExp.$1+"',item.moduleId,item.sort,'up')\">\n                    <i class=\"glyphicon glyphicon-arrow-up\"></i>\n                  </span>\n                  <span class=\"icon-module-sort-down\" @click=\"sortModuleHandle('haveMaster','"+RegExp.$1+"',item.moduleId,item.sort,'down')\">\n                    <i class=\"glyphicon glyphicon-arrow-down\"></i>\n                  </span>\n                  <span class=\"icon-module-sort-remove\" @click=\"removeModuleHandle('haveMaster','"+RegExp.$1+'\',item.moduleId,item.sort)">\n                    <i class="glyphicon glyphicon glyphicon-remove"></i>\n                  </span>\n                </div>\n                <div class="module-content" v-html="item.content"></div>\n              </div>');new r.c({template:'<div class="design-have-master-container">'+l+"</div>",data:function(){return{masterPlaceMap:n.masterPlaceMap}},parent:n,methods:{addModuleHandle:function(e,t){n.addModuleHandle(e,t)},editModuleHandle:function(e,t,o,r){n.editModuleHandle(e,t,o,r)},removeModuleHandle:function(e,t,o,r){n.removeModuleHandle(e,t,o,r)},sortModuleHandle:function(e,t,o,r,a){n.sortModuleHandle(e,t,o,r,a)}}}).$mount(document.getElementById("placeRef"))}return[4,a.Container.get("designService").getDesignPageModulesAction(this.pageId)];case 3:if((v=u.sent())&&v.length>0)if(this.masterId>0)for(f=0,g=v;f<g.length;f++)M=g[f],this.masterPlaceMap.haveMaster.hasOwnProperty(M.placeholder)&&this.masterPlaceMap.haveMaster[M.placeholder].push(M),$("#haveMaster-"+M.placeholder+"-plus").closest("div").append('<script src="'+M.script+'"><\/script>');else for(this.masterPlaceMap.noMaster["0placeholder"]=v,y=0,I=v;y<I.length;y++)M=I[y],$("#noMaster-"+M.placeholder+"-plus").closest("div").append('<script src="'+M.script+'"><\/script>');this.parentVm.initPageModulesInfo(this.masterPlaceMap,this.masterId>0?"haveMaster":"noMaster"),u.label=4;case 4:return[2]}})})},t.prototype.removeModuleHandle=function(e,t,n,o){for(var r=this.masterPlaceMap[e][t],a=0;a<r.length;a++){var s=r[a];if(s.moduleId==n&&s.sort==o){r.splice(a,1);break}}for(var a=0;a<r.length;a++)r[a].sort=a+1},t.prototype.sortModuleHandle=function(e,t,n,o,r){for(var a=this.masterPlaceMap[e][t],s=0;s<a.length;s++){var i=a[s];if(i.moduleId==n&&i.sort==o){switch(r){case"up":if(1==i.sort)break;var l=a[s-1];l.sort=l.sort+1,i.sort=i.sort-1,this.$set(a,s-1,i),this.$set(a,s,l);break;case"down":if(i.sort==a.length+1)break;var c=a[s+1];c.sort=c.sort-1,i.sort=i.sort+1,this.$set(a,s+1,i),this.$set(a,s,c)}break}}},t.prototype.addModuleHandle=function(e,t){return p(this,void 0,void 0,function(){return u(this,function(n){return this.placeholder=t,this.masterKey=e,this.parentVm.addModuleHandle(e,t),[2]})})},t.prototype.closeSchemaDialog=function(){this.schemaDialogClass="",$(".json-schema-form-container").animate({scrollTop:0},1e3)},t.prototype.editModuleHandle=function(e,t,n,o){return p(this,void 0,void 0,function(){return u(this,function(r){return this.placeholderModuleSort=o,this.placeholder=t,this.masterKey=e,this.parentVm.editModuleHandle(e,t,n,o,this.masterPlaceMap),[2]})})},t.prototype.saveSchemaForm=function(e,t){return p(this,void 0,void 0,function(){var n,o,r,s;return u(this,function(i){switch(i.label){case 0:return[4,a.Container.get("designService").renderModuleHtmlPostAction(this.pageId,t.moduleId,t.version,e.formData)];case 1:if(n=i.sent(),!n.errorCode)for(o=0,r=this.masterPlaceMap[this.masterKey][this.placeholder];o<r.length;o++)if(s=r[o],s.moduleId==t.moduleId&&s.sort==this.placeholderModuleSort){s.content=n.content,s.data=JSON.stringify(e.formData);break}return[2]}})})},t.prototype.chooseModuleHandle=function(e){return p(this,void 0,void 0,function(){var t,n,o,r;return u(this,function(s){switch(s.label){case 0:return[4,a.Container.get("designService").renderModuleHtmlGetAction(this.pageId,e.moduleId,e.version)];case 1:return t=s.sent(),t.errorCode?[3,3]:[4,a.Container.get("moduleService").getModuleVersionInfoById(e.moduleId)];case 2:n=s.sent(),n.errorCode||(o=n,r=this.masterPlaceMap[this.masterKey][this.placeholder],0==r.length?r.push({placeholder:this.placeholder,sort:1,moduleName:o.moduleName,content:t.content,moduleId:e.moduleId,version:e.version,schemaDesc:o.schemaDesc,data:o.data,versionInfoId:o.versionInfoId}):r.push({placeholder:this.placeholder,sort:r.length+1,moduleName:o.moduleName,content:t.content,moduleId:e.moduleId,version:e.version,schemaDesc:o.schemaDesc,data:o.data,versionInfoId:o.versionInfoId}),this.masterPlaceMap[this.masterKey][this.placeholder]=r,this.parentVm.initPageModulesInfo(this.masterPlaceMap,this.masterKey)),$("#"+this.masterKey+"-"+this.placeholder+"-plus").closest("div").append('<script src="'+t.script+'"><\/script>'),s.label=3;case 3:return[2]}})})},t=d([n.i(r.a)({template:n("74/Y"),components:{module:s.a}})],t)}(r.b));t.default=h}},[0]);